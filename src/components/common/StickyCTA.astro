---
import { Image } from "astro:assets";
import beeldmerk from "../../assets/graphics/Beeldmerk_RGB_FC.png";
import { useTranslations } from "../../i18n/utils";

const { lang = 'nl' } = Astro.params;
const t = useTranslations(lang as any);
---

<!-- Mobile Bottom Bar (Glassmorphic) -->
<div class="md:hidden fixed bottom-6 left-1/2 -translate-x-1/2 z-50 w-[92%] max-w-sm">
    <div class="bg-white/90 backdrop-blur-xl border border-white/20 rounded-2xl p-2 shadow-2xl flex items-center gap-3">
        <!-- Contact Icon (Secondary) -->
        <a href={`/${lang}/contact`} class="flex items-center justify-center w-12 h-12 rounded-xl bg-gray-50 text-gray-600 hover:bg-gray-100 active:bg-gray-200 transition-colors shrink-0">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
        </a>

        <!-- Booking CTA (Primary) -->
        <a href={`/${lang}/contact`} class="flex-1 bg-kaap-gradient text-white font-bold text-center py-3.5 rounded-xl shadow-md active:scale-95 transition-transform uppercase tracking-wider text-sm flex items-center justify-center gap-2">
            <span>{t('cta.book')}</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
        </a>
    </div>
</div>

<!-- Desktop Floating Button -->
<a
  id="sticky-cta-desktop"
  href={`/${lang}/contact`}
  class="hidden md:flex fixed bottom-8 right-8 z-40 group items-center justify-center w-20 h-20 transition-transform duration-300 hover:scale-110 text-white"
>
  <!-- Beeldmerk Graphic Container - Spins 360deg on hover -->
  <div
    class="absolute inset-0 w-full h-full transition-transform duration-700 ease-in-out group-hover:rotate-180"
  >
    <Image
      src={beeldmerk}
      alt="Contact"
      class="w-full h-full object-contain drop-shadow-xl"
    />
  </div>

  <!-- Icon Container -->
  <div
    class="relative z-10 w-8 h-8 flex items-center justify-center pointer-events-none"
  >
    <!-- Icon (Message/Chat) -->
    <svg
      class="sticky-icon absolute inset-0 w-full h-full drop-shadow-md transition-all duration-300 ease-in-out transform group-hover:opacity-0 group-hover:scale-50 text-white"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
      ></path>
    </svg>

    <!-- Icon (Arrow Right) -->
    <svg
      class="sticky-icon absolute inset-0 w-full h-full drop-shadow-md opacity-0 scale-50 transition-all duration-300 ease-in-out transform group-hover:opacity-100 group-hover:scale-100 text-white"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
    </svg>
  </div>

  <!-- Optional: Tooltip on left -->
  <span
    class="hidden md:block absolute right-full mr-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-black/80 text-white text-sm font-bold px-3 py-1 rounded whitespace-nowrap pointer-events-none"
  >
    {t('footer.contact')}
  </span>
</a>

<script>
  const stickyCTA = document.getElementById("sticky-cta-desktop");

  function checkContrast() {
    if (!stickyCTA) return;

    // Get button center position
    const rect = stickyCTA.getBoundingClientRect();
    const x = rect.left + rect.width / 2;
    const y = rect.top + rect.height / 2;

    // Find elements under the button
    const elements = document.elementsFromPoint(x, y);

    // Find the first section with a data-theme attribute
    // We look for the closest section in the stack of elements under the point
    const themeSection = elements
      .find((el) => el.closest("section[data-theme]"))
      ?.closest("section[data-theme]");

    if (themeSection) {
      const theme = themeSection.getAttribute("data-theme");
      if (theme === "light") {
        updateIcons("text-kaap-gray");
      } else {
        updateIcons("text-white");
      }
    }
  }

  function updateIcons(colorClass: string) {
    if (!stickyCTA) return;
    const icons = stickyCTA.querySelectorAll(".sticky-icon");
    icons.forEach((icon) => {
      // Check if already has class to avoid thrashing
      if (!icon.classList.contains(colorClass)) {
        icon.classList.remove("text-white", "text-kaap-gray");
        icon.classList.add(colorClass);
      }
    });
  }

  // Check on scroll and resize
  window.addEventListener("scroll", checkContrast, { passive: true });
  window.addEventListener("resize", checkContrast, { passive: true });

  // Initial check
  checkContrast();
</script>
