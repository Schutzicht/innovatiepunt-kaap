---
import { Image } from 'astro:assets';
import iconWater from '../../assets/icons/Kaap_RGB_Water_Blok.png';
import iconFood from '../../assets/icons/Kaap_RGB_Food_Blok.png';
import iconEnergy from '../../assets/icons/Kaap_RGB_Energie_Blok.png';

// Import images for the circle
import themeWater from '../../assets/photos/theme-water.jpg';
import themeFood from '../../assets/photos/theme-food.jpg';
import themeEnergy from '../../assets/photos/theme-energy.jpg';
import beeldmerk from '../../assets/graphics/Beeldmerk_RGB_FC.png';

const themes = [
  {
    id: 'food',
    label: 'Food',
    icon: iconFood,
    color: 'text-kaap-food',
    bg: 'bg-kaap-food',
    image: themeFood,
    borderColor: 'border-kaap-food'
  },
  {
    id: 'water',
    label: 'Water',
    icon: iconWater,
    color: 'text-kaap-water',
    bg: 'bg-kaap-water',
    image: themeWater,
    borderColor: 'border-kaap-water'
  },
  {
    id: 'energy',
    label: 'Energy',
    icon: iconEnergy,
    color: 'text-kaap-energy',
    bg: 'bg-kaap-energy',
    image: themeEnergy,
    borderColor: 'border-kaap-energy'
  }
];
---

<section id="sleek-themes" class="relative w-full h-auto min-h-[600px] md:min-h-[800px] bg-[#222323] overflow-hidden flex flex-col md:flex-row">
  
  <!-- Left Content Area (Main) -->
  <div class="relative flex-1 flex items-center justify-center p-6 md:p-24 z-10 transition-colors duration-700 order-1" id="main-bg">
    
    <!-- Background Elements -->
    <div class="absolute top-6 left-6 md:top-12 md:left-12">
        <span class="text-white/60 uppercase tracking-widest text-[10px] md:text-xs font-bold font-heading">Innovatiepunt</span>
        <div class="h-0.5 w-8 md:w-12 bg-white/60 mt-2"></div>
    </div>

    <!-- Centered Circle & Text -->
    <div class="relative w-full md:max-w-6xl flex flex-col md:grid md:grid-cols-2 gap-8 md:gap-12 items-center">
        
        <!-- Circle Visual - Scaled Down on Mobile -->
        <div class="relative order-1 md:order-1 flex justify-center w-full mt-16 mb-16 md:mt-0 md:mb-0">
             <!-- Beeldmerk Graphic (Replaces CSS Ring) -->
             <div class="absolute inset-0 m-auto w-[280px] h-[280px] md:w-[500px] md:h-[500px] animate-spin-slow opacity-80 select-none pointer-events-none">
                 <Image src={beeldmerk} alt="KAAP Beeldmerk" class="w-full h-full object-contain" />
             </div>
             
             <!-- Image Mask -->
             <div class="w-[160px] h-[160px] md:w-[320px] md:h-[320px] rounded-full overflow-hidden border-4 md:border-8 border-[#1a1a1a] shadow-2xl relative z-10">
                {themes.map((theme) => (
                    <div 
                        class={`absolute inset-0 w-full h-full transition-opacity duration-700 ${theme.id === 'food' ? '' : 'opacity-0'}`} 
                        data-theme-img={theme.id}
                    >
                         <Image src={theme.image} alt={theme.label} class="w-full h-full object-cover" />
                    </div>
                ))}
             </div>
        </div>

        <!-- Typography -->
         <div class="order-2 text-center md:text-left z-20 w-full">
            <h2 class="text-4xl md:text-7xl font-bold font-heading text-white leading-[1.1] mb-6 md:mb-0">
                Bring <br/>
                your <span id="dynamic-word" class="text-kaap-food transition-colors duration-500">food</span> <br/>
                innovation <br/>
                to life
            </h2>
            <div class="mt-4 md:mt-8 flex justify-center md:justify-start items-center space-x-4">
                <a href="/voedsel" id="dynamic-link" class="text-white border-b border-white pb-1 hover:text-gray-300 transition-colors text-sm md:text-base">Ontdek de transitie</a>
            </div>
        </div>
    </div>

    <!-- KAAP Logo Overlay (Bottom Right) -->
    <div class="absolute bottom-6 right-6 md:bottom-12 md:right-32 text-white font-bold text-xl md:text-2xl tracking-tighter">
        KAAP
    </div>
  </div>

  <!-- Mobile Navigation Bar (Bottom) / Desktop Sidebar (Right) -->
  <div class="relative w-full md:w-32 h-auto md:h-auto bg-[#222] flex flex-row md:flex-col items-center justify-between md:justify-start p-4 md:p-0 md:pt-32 gap-0 border-t md:border-t-0 md:border-l border-white/5 z-20 order-2">
      
      {themes.map((theme) => (
          <button 
            class={`theme-nav-btn group flex-1 md:flex-none w-auto md:w-full h-16 md:h-32 flex items-center justify-center relative focus:outline-none transition-all duration-200 hover:bg-white/5 active:scale-95 active:bg-white/10 cursor-pointer ${theme.id === 'food' ? 'active' : ''}`}
            data-target={theme.id}
          >
              <!-- Active Indicator Bar -->
              <!-- Desktop: Vertical Right Bar -->
              <div class="hidden md:block absolute right-0 top-0 bottom-0 w-1 bg-transparent group-hover:bg-white/20 transition-colors indicator transform scale-y-0 group-[.active]:scale-y-100 group-[.active]:bg-white transition-transform duration-300 origin-center"></div>
              
              <!-- Mobile: Top Horizontal Bar -->
              <div class="md:hidden absolute top-0 left-0 right-0 h-1 bg-transparent group-hover:bg-white/20 transition-colors indicator transform scale-x-0 group-[.active]:scale-x-100 group-[.active]:bg-white transition-transform duration-300 origin-center"></div>
              
              <div class="w-8 h-8 md:w-10 md:h-10 transition-transform duration-300 group-hover:scale-110 opacity-50 group-[.active]:opacity-100">
                  <Image src={theme.icon} alt={theme.label} class="w-full h-full object-contain" />
              </div>

              <!-- Tooltip/Label (Desktop Only) -->
              <span class="hidden md:block absolute left-4 opacity-0 group-hover:opacity-100 -translate-x-full md:translate-x-0 md:-left-4 md:group-hover:-translate-x-full transition-all duration-300 text-white text-sm font-bold bg-black/80 px-2 py-1 rounded pointer-events-none whitespace-nowrap">
                  {theme.label}
              </span>
              
              <!-- Mobile Label (Visible only if active?) No, let's keep it simple with just icons on mobile -->
          </button>
      ))}
  </div>
</section>

<style>
    .animate-spin-slow {
        animation: spin 20s linear infinite;
    }
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
</style>

<script>
    function initThemes() {
        console.log('ThemesInteractive: Initializing...');
        
        type ThemeKey = 'food' | 'water' | 'energy';

        // Theme Data
        const themeData: Record<ThemeKey, { color: string; border: string; word: string; url: string }> = {
            'food': { color: 'text-kaap-food', border: 'border-kaap-food', word: 'food', url: '/voedsel' },
            'water': { color: 'text-kaap-water', border: 'border-kaap-water', word: 'water', url: '/water' },
            'energy': { color: 'text-kaap-energy', border: 'border-kaap-energy', word: 'energy', url: '/energie' }
        };

        const buttons = document.querySelectorAll('.theme-nav-btn');
        const dynamicWord = document.getElementById('dynamic-word');
        const dynamicLink = document.getElementById('dynamic-link');
        const ringAccent = document.getElementById('ring-accent');
        const imgs = document.querySelectorAll('[data-theme-img]');
        
        if (!buttons.length) {
            console.error('ThemesInteractive: No buttons found');
            return;
        }

        function setTheme(themeId: string) {
            const key = themeId as ThemeKey;
            if (!themeData[key]) return;
            console.log('ThemesInteractive: Setting theme to', key);
            
            // 1. Update Buttons
            buttons.forEach(btn => {
                if (btn.getAttribute('data-target') === themeId) {
                    btn.classList.add('active');
                    // Ensure the indicator is visible
                } else {
                    btn.classList.remove('active');
                }
            });

            // 2. Update Text & Link
            if (dynamicWord) {
                const data = themeData[key];
                
                // Change classes and text immediately
                dynamicWord.className = `${data.color} transition-colors duration-300`;
                dynamicWord.innerText = data.word;
                
                // Update Link URL
                if (dynamicLink) {
                    dynamicLink.setAttribute('href', data.url);
                }
            }

            // 3. Update Image
            imgs.forEach(img => {
                if (img.getAttribute('data-theme-img') === themeId) {
                    img.classList.remove('opacity-0');
                } else {
                    img.classList.add('opacity-0');
                }
            });
        }

        // Init
        // setTheme('food'); // Default is already set in HTML to some extent, but let's enforce it? 
        // Actually, HTML static content is "food", so we don't need to force run it unless we want to reset.
        // Let's just listen.

        // Initialize activeTheme with the default (or currently active class)
        let activeTheme = 'food';
        buttons.forEach(btn => {
            if (btn.classList.contains('active')) {
                const target = btn.getAttribute('data-target');
                if (target) activeTheme = target;
            }
        });

        const navContainer = document.querySelector('.flex.flex-row.md\\:flex-col');

        // Listeners
        buttons.forEach(btn => {
            btn.addEventListener('mouseenter', () => {
                const target = btn.getAttribute('data-target');
                if (target) setTheme(target);
            });
            
            btn.addEventListener('click', (e) => {
                e.preventDefault(); // Prevent jump
                const target = btn.getAttribute('data-target');
                if (target) {
                    activeTheme = target;
                    setTheme(target);
                }
            });
        });

        // Revert to active theme when leaving the navigation area
        if (navContainer) {
            navContainer.addEventListener('mouseleave', () => {
                setTheme(activeTheme);
            });
        }
    }

    // Run on load
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initThemes);
    } else {
        initThemes();
    }
    
    // Support View Transitions if added later
    document.addEventListener('astro:page-load', initThemes);
</script>
